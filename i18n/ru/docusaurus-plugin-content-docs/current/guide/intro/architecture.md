---
sidebar_position: 2
sidebar_label: Архитектура
title: "Архитектура"
id: architecture
slug: /guide/architecture
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

import LogoNodeJS from '@site/static/img/guide/about/stack/nodejs_logo.svg';
import LogoRN from '@site/static/img/guide/about/stack/rn_logo.svg';
import LogoMongo from '@site/static/img/guide/about/stack/mongo_logo.svg';
import LogoFirebase from '@site/static/img/guide/about/stack/firebase_logo.svg';

## Стек технологий {#tech_stack}

<Tabs>
  <TabItem value="1" label="NodeJS" default style={{display: 'flex'}}>
    <LogoNodeJS className="blackSvgIcon"  style={{width: "10%",height: '100%',marginRight: 20, float: 'left'}}/>
    NodeJS + Express позволяет быстро обрабатывать большое количество запросов и охватывать большую аудиторию пользователей
  </TabItem>
  <TabItem value="2" label="React Native">
    <LogoRN className="blackSvgIcon"  style={{width: "10%",height: '100%',marginRight: 20, float: 'left'}}/>
    Наш интерфейс написан на React Native, что позволяет обеспечить кроссплатформенность продукта и поддержку Web, iOS, Android
  </TabItem>
  <TabItem value="3" label="MongoDB">
    <LogoMongo className="blackSvgIcon"  style={{width: "10%",height: '100%',marginRight: 20, float: 'left'}}/>
    Для хранения данных используется MongoDB, что обеспечивает большую масштабируемость и высокую гибкость схемы.
  </TabItem>
  <TabItem value="4" label="Firebase">
    <LogoFirebase className="blackSvgIcon"  style={{width: "10%",height: '100%',marginRight: 20, float: 'left'}}/>
    Вы будете оповещены о важных событиях. Настраивайте свои уведомления или получайте их от других пользователей. Все взаимодействия между пользователями сопровождаются динамическим обновлениям данных на обоих устройствах
  </TabItem>
</Tabs>

## Архитектура {#architecture}

Приложение является кроссплатформенным и доступно на платформах: Web, iOS, Android

Приложение имеет 2 режима верстки:

- Узкая (телефон)
- Широкая (веб, планшет)  
  Обе разметки также можно применять на всех устройствах.

:::info Единый код

Приложение основано на едином коде для всех платформ за редким исключением, когда:

- Библиотека не адаптирована под все платформы (используются несколько)
- Особенности восприятия интерфейса требуют реализовать разный функционал/вид для разных платформ

Что позволяет реализовать единую логику и сократить количество уязвимых мест

:::

## Локальное хранилище {#local_storage}

Сервер использует общую БД MongoDB, но мобильные устройства используют **дополнительную локальную** MongoDB.

Это позволяет решить следующие задачи:

### Актуальность данных {#data_relevance}

Благодаря синхронизации присходит обмен только актуальной информацеий.

При общении с сервером приложение отправляет следуюшие данные:

<Tabs>
  <TabItem value="1" label="Чтение" default>
  <ul>
    <li>url (путь до области нужных данных в БД)</li>
    <li>devicetime (время устройства на момент отправки запроса к серверу)</li>
  </ul>
  </TabItem>
  <TabItem value="2" label="Запись">
  <ul>
    <li>url (путь до области нужных данных в БД)</li>
    <li>devicetime (время устройства на момент отправки запроса к серверу)</li>
    <li>data (данные для записи)</li>
    <li>time (время считывания данных на устройстве)</li>
  </ul>
  </TabItem>
</Tabs>

Как сервер понимает, что информация актуальна, описано в разделе **механизм синхронизации** этой главы

### Оффлайн {#offline}

Локальная БД на устройствах позволяет вести непрерывное заполнение журналов даже без доступа к сети благодаря **механизму синхронизации**

### Механизм синхронизации {#synchronization_mechanism}

При действии с БД данные отправляются на сервер (при наличии сети), иначе транзакция добавляется в очередь синхронизации
При получении запроса сервер сравнивает последнее время изменения данных в БД и время, указанное в данных запроса.

Данные считаются актуальными, если:  
**Чтение:** если время на запроса меньше последнего времени изменения данных в БД.  
**Запись:** если время на момент записи данных меньше последнего времени изменения данных в БД. Это значит, что уже записаны более новые данные.
В случае актуальности данных, сервер перезаписывает их в БД и возвращает актуальное время на момент записи в БД. (Actual time = req.devicetime - servertime + req.time)

После выгрузки всех данных из очереди на сервер запрашиваются актуальные данные из БД сервера.
