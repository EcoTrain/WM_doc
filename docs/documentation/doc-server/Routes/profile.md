---
sidebar_position: 6
title: "profile"
---

# Текущий пользователь

Данный роутер управляет маршрутами **текущего пользователя** для поиска и редактировании информации о профиле

## Получение

URL: `/api/profile/get`

Маршрут для получения информации о пользователе. В случае, если в запросе присутствует поле `url`, возвращаются данные, находящиеся по этому пути в БД, иначе возвращается весь объект пользователя целиком.

```json title="[POST] request body"
{ 
  "url": "<field_path>",
  "time": "<timestamp>"
}
```

```json title="[POST] response body"
{ 
  "_V": "<wrapped user field obj>",
  "_T": "<timestamp>"
}
```

Сервер сравнивает время клиента с временем записи в БД. Если время клиента меньше того, что записано в БД, сервер возвращает объект.  

```json title="Example"
req: { "url": "personal" }
resp: {
    "_V": {
        "LastName": {
            "_V": "Крикунов",
            "_T": 1634291174841
        },
        "FirstName": {
            "_V": "Егор",
            "_T": 1634291174841
        },
        "MiddleName": {
            "_V": "Васильевич",
            "_T": 1634291174841
        },
        "gender": {
            "_V": 1,
            "_T": 1634291174841
        },
        "birthDate": {
            "_V": 705884400000,
            "_T": 1634291174841
        }
    },
    "_T": 1634291174841
}
```
Иначе сервер возвращает пустой объект (данные не актуальны): 
```json title="[POST] response body"
{ "_V": null, "_T": null}
```


## Обновление

URL: `/api/profile/update`

Маршрут для обновления информации о текущем пользователе в БД. Редактирование профиля.


```json title="[POST] request body"
{
  "url": "<field_path>", 
  "value": "<new_value>",
  "time": "time",      
  "devicetime": "time" 
}
```
**url**: ex: отправки  
**value**:  Данные для вставки в БД. Это может быть как строка, так и большой объект.  
**time**: время создания записи на устройстве клиента  
**devicetime**: время отправки записи (если на момент отправки подключение к сети отсутствовало, запись отправится позже).  


По заданному `url` производится поиск данных в БД.   
* Если такие данные есть, они перезаписываются, и в ответе пишется время записи из БД.  
* Если такие данные отсутствуют, они создаются по заданному `url`, а в ответе пишется актуальное время сервера (время записи).


## Наполнение дневников

URL: `/api/profile/fill_diary`

Маршрут для заполнения дневников случайными значениями в допустимых пределах переменных.

```json title="[POST] request body"
{ "count": "<int number>" }
```

**Если параметр `count` не задан:**
```json title="[POST] response body"
{   
  "message": "Укажите количество записей. Данные не обновлены",
  "code": -1,
  "time": "<timestamp>"
}
```

**Если количество генерируемых записей задано:**  
* Сервер получает информацию из профиля пользователя о переменных и истории их изменения.  
* Для каждой переменной узнаёт её пределы и генерирует значение.
* Записывает это значение в историю переменной

